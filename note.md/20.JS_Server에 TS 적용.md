# ìë°”ìŠ¤í¬ë¦½íŠ¸ ì„œë²„ì— íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì ìš©í•˜ê¸°

## ğŸ– íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì ìš©í•˜ê¸°

### ì„œë²„ì— íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ ì ìš© ì¤€ë¹„ ê³¼ì • (ê°œë°œ í™˜ê²½ ì„¸íŒ…(ts-node / nodemon))

> **ì´ˆë°˜ ì„¤ì • ë°©ë²•(ê¸°ë³¸)**  
> https://www.codeit.kr/topics/javascript-server-with-typescript/lessons/7159
>
> ```
> npm init
> ```
>
> enterë¡œ ë‹¤ ë„˜ì–´ê°€ê¸°
>
> ```
> npm install express
> ```
>
> ```json
> "scripts": {
>   "start": "node dist/app.js",
>    "build": "tsc"
> },
> ```
>
> ```
> npm install --save-dev typescript
> ```
>
> ```
> npx tsc init
> ```
>
> ğŸ‘‰ tsconfig íŒŒì¼ì´ ìƒì„±ë¨
> ì†ŒìŠ¤ì½”ë“œ íŒŒì¼ í´ë”(src)ë¥¼ ìƒì„± (app.ts ë“± ì˜®ê¹€)
>
> ```json
> "compilerOptions": {
> // ...
>
> "rootDit": "src",
> // ...
> "outDir": "dist",
>
> // ...
> }
> ```

![](https://velog.velcdn.com/images/pmj9498/post/cdda205c-c0ea-4579-af21-5fe2351d6195/image.png)

ìœ„ ì²˜ëŸ¼ tsíŒŒì¼ì—ì„œ ë³€ê²½í•œ ë¶€ë¶„ì´ ìˆì„ ë•Œ ë§ˆë‹¤ `build`ë‘ `start`ë¥¼ í•´ì¤˜ì•¼ í•˜ëŠ” **ë¶ˆí¸í•œ ì **ì´ ìˆë‹¤.  
ì´ ë¶€ë¶„ì„ í•´ê²°í•˜ê¸° ìœ„í•œ ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì„œ **ê°œë°œ í™˜ê²½ ì†ì—ì„œ í¸í•˜ê²Œ ì‚¬ìš©í•˜ëŠ” ë²•ì„ ì•Œì•„ë³´ì.**

#### ts-node

`build`ì™€ `start`ë¥¼ ë¶ˆí¸í•˜ê²Œ ì•ˆí•´ë„ í•œ ë²ˆì— í™•ì¸í•  ìˆ˜ ìˆê²Œë” í•œë‹¤.

> [ts-node ê³µì‹ ì‚¬ì´íŠ¸](https://www.npmjs.com/package/ts-node?activeTab=readme)

```
# Locally in your project.
npm install -D typescript
npm install -D ts-node

# Or globally with TypeScript.
npm install -g typescript
npm install -g ts-node

# Depending on configuration, you may also need these
npm install -D tslib @types/node
```

> `-D`ëŠ” `--save-dev`ë¥¼ ì§§ê²Œ ì“´ ê²ƒ!

```
npm install --save-dev ts-node
```

![](https://velog.velcdn.com/images/pmj9498/post/c56df108-457e-4cb1-87b8-2bbab63e23b1/image.png)

```json
// devë¥¼ ì¶”ê°€í•´ì¤˜ì„œ í¸ë¦¬í•˜ê²Œ ì‚¬ìš©
"scripts": {
  "dev": "ts-node src/app.ts"
}
```

![](https://velog.velcdn.com/images/pmj9498/post/69452d1d-b922-4da6-be88-bdaa14b12f5c/image.png)

ì´ì   `build`ì™€ `start`ë¥¼ ë²ˆê±°ë¡­ê²Œ ì…ë ¥ ì•ˆ í•´ë„ `dev`ë¥¼ í†µí•´ í•œ ë²ˆì— ë³€ê²½í•œ ë¶€ë¶„ì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

#### nodemon

![](https://velog.velcdn.com/images/pmj9498/post/0b692f0f-9ca9-4adc-acb8-aa71801668cd/image.png)

> [nodemon ê³µì‹](https://nodemon.io/) / [nodemon documentation](https://github.com/remy/nodemon#nodemon)

nodemonì€ ì†ŒìŠ¤ì½”ë“œë¥¼ ë³€ê²½í•˜ë©´ ì•Œì•„ì„œ ì¬ì‹¤í–‰í•´ì£¼ëŠ” ë°ì— ì‚¬ìš©í•œë‹¤.

```
npm install --save-dev nodemon
# or using yarn: yarn add nodemon -D
```

```json
"scripts": {
  "dev": "nodemon --watch src --exec ts-node src/app.ts"
}
```

![](https://velog.velcdn.com/images/pmj9498/post/df527279-6066-46ca-a407-d06d1376aff7/image.png)

`dev` ëª…ë ¹ì–´ë¥¼ ë°”ê¿”ì£¼ê³  ì‹¤í–‰í•´ ë³´ë©´,

![](https://velog.velcdn.com/images/pmj9498/post/cc73873d-788b-4cba-963f-e6b3858ae94d/image.png)

ë”°ë¡œ ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šì•„ë„ ìˆ˜ì •í•˜ë©´ ì•Œì•„ì„œ ì‹¤í–‰ëœë‹¤.

> ì°¸ê³ ë¡œ ìµœì‹  ë²„ì „ì— nodemonì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ì€ `--exec`ì— ëŒ€í•´ì„œ ts-nodeë¥¼ ì‚¬ìš©í•˜ê²Œ í•´ì¤€ë‹¤.
> ê·¸ë˜ì„œ ì•„ë˜ì™€ ê°™ì´ `--exec ts-node`ë¥¼ ì—†ì• ë„ ë¬¸ì œ ì—†ë‹¤.

```json
"scripts": {
  "dev": "nodemon --watch src src/app.ts"
}
```

### íŒ¨í‚¤ì§€ ì„¤ì¹˜í•˜ê¸°

íŒ¨í‚¤ì§€ì—ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•˜ëŠ” ê²½ìš°, ë”°ë¡œ ì„¤ì¹˜í•´ ì¤„ í•„ìš”ê°€ ì—†ë‹¤. ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œë§Œ ëœ íŒ¨í‚¤ì§€ë¼ë©´ ë”°ë¡œ íƒ€ì… ì •ì˜ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ ì£¼ì–´ì•¼ í•œë‹¤. ì´ë•Œ íƒ€ì… ì •ì˜ íŒ¨í‚¤ì§€ëŠ” `@types/`ë¡œ ì‹œì‘í•˜ëŠ” íŒ¨í‚¤ì§€ë¥¼ [NPM í™ˆí˜ì´ì§€](https://www.npmjs.com/)ì—ì„œ ì°¾ì•„ë³´ë©´ ëœë‹¤. ë§Œì•½ í•´ë‹¹í•˜ëŠ” íƒ€ì… ì •ì˜ íŒ¨í‚¤ì§€ê°€ ìˆë‹¤ë©´ `npm install --save-dev`ì˜µì…˜ìœ¼ë¡œ ì„¤ì¹˜í•˜ë©´ ëœë‹¤.

![](https://velog.velcdn.com/images/pmj9498/post/d338ea3f-e4fa-4e0d-8487-18afbbc74182/image.png)

expressëŠ” jsë¡œ ëœ íŒ¨í‚¤ì§€ë¼ íƒ€ì… ì •ì˜ íŒ¨í‚¤ì§€ë¥¼ ë”°ë¡œ ì„¤ì¹˜í•´ì¤˜ì•¼ í•œë‹¤.

```
npm install --save-dev @types/express
```

![](https://velog.velcdn.com/images/pmj9498/post/052105bb-8449-4c2b-9cef-050ea9559c84/image.png)

### Express í•¸ë“¤ëŸ¬ íƒ€ì…

ê¸°ë³¸ì ìœ¼ë¡œ `Request`, `Response`, `NextFunction` íƒ€ì…ì´ ìˆìœ¼ë©°, ì´ê²ƒ ë§ê³ ë„ `RequestHandler` íƒ€ì…ì„ ì‚¬ìš©í•˜ë©´ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ì˜ íƒ€ì…ì„ í•œ ë²ˆì— ì •ì˜í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

> ê¶ê¸ˆí•œ íƒ€ì…ì´ ìˆë‹¤ë©´ Windowsì—ì„œëŠ” `Ctrl` + `Click`, macOSì—ì„œëŠ” `Cmd` + `Click`ì„ í•´ì„œ í™•ì¸í•  ìˆ˜ ìˆìœ¼ë‹ˆ í•´ë³´ì!
> ê·¸ë¦¬ê³  ê°ì²´ í”„ë¡œí¼í‹°ëŠ” ë§ˆì¹¨í‘œ(`.`)ë¥¼ ì…ë ¥í•˜ì—¬ ìë™ ì¶”ì²œìœ¼ë¡œ ëœ¨ëŠ” í”„ë¡œí¼í‹°ë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.
> ![](https://velog.velcdn.com/images/pmj9498/post/31fc4d7d-870f-4856-83c9-859fef7de761/image.png)

```ts
import express, { NextFunction, Request, Response } from "express";

const app = express();

const handler = (req: Request, res: Response, next: NextFunction) => {
  res.send();
};

app.get("/", handler);

app.listen(3000, () => {
  console.log("Server running on port 3000");
});
```

ìœ„ì˜ ì½”ë“œì—ì„œ `RequestHandler`ë¥¼ í†µí•´ `handler` í•¨ìˆ˜ë¥¼ í•œ ë²ˆì— íƒ€ì…ì„ ì§€ì •í•˜ì—¬ ì •ì˜í•  ìˆ˜ ìˆë‹¤.

```ts
import express, {
  NextFunction,
  Request,
  RequestHandler,
  Response,
} from "express";

const app = express();

// handlerë¥¼ íƒ€ì… ì§€ì •ì„ í•˜ì—¬ í•œ ë²ˆì— ì²˜ë¦¬
const handler: RequestHandler = (req, res, next) => {
  res.send();
};

app.get("/", handler);

app.listen(3000, () => {
  console.log("Server running on port 3000");
});
```

```ts
// ì˜ˆì‹œ ë¬¸ì œ
import express, {
  Request,
  Response,
  NextFunction,
  RequestHandler,
  ErrorRequestHandler,
} from "express";

const app = express();

function hello(req: Request, res: Response, next: NextFunction) {
  res.send("Hello");
}

const bye: RequestHandler = (req, res, next) => {
  res.send("Bye");
};

// use() í•¨ìˆ˜ íƒ€ì…ì„ í™•ì¸í•˜ì—¬ íƒ€ì… ì§€ì •
const errorHandler: ErrorRequestHandler = (err, req, res, next) => {
  res.status(500).send("Error!");
};

app.get("/", (req, res, next) => {
  res.send("OK");
});
app.get("/hello", hello);
app.get("/bye", bye);
app.use(errorHandler);

app.listen(3000, () => {
  console.log("Server running on port 3000");
});
```

### íƒ€ì… ì»¤ìŠ¤í…€í•˜ê¸°

ì™¸ë¶€ ëª¨ë“ˆì— ëŒ€í•´ì„œ `declare` ë¬¸ë²•ì„ í™œìš©í•˜ë©´ íƒ€ì…ì„ ë®ì–´ì“¸ ìˆ˜ ìˆë‹¤. `interface` ë¬¸ë²•ì˜ ê²½ìš° ì´ë¯¸ ì •ì˜ëœ `interface`ì™€ í•©ì³ì§€ê¸° ë•Œë¬¸ì— ë‚´ê°€ ì›í•˜ëŠ” íŠ¹ì • í”„ë¡œí¼í‹°ëŠ” ì•„ë˜ì™€ ê°™ì´ ê°„ë‹¨íˆ ì¶”ê°€í•´ì¤„ ìˆ˜ ìˆì£ .

```ts
import Express from "express";

declare global {
  namespace Express {
    interface Request {
      valid?: boolean;
    }
  }
}
```

#### npm run dev(ts-node) ì˜¤ë¥˜ í•´ê²°

`npm run build` `npm start`ëŠ” ì˜ ì‹¤í–‰ë˜ì§€ë§Œ, `npm run dev`ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.
![](https://velog.velcdn.com/images/pmj9498/post/4f0fa6f3-5ad4-4a3c-a5a0-b237f92f8368/image.png)

â— ì´ìœ ëŠ” `ts-node`ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ íƒ€ì… ì •ì˜ íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¤ì§€ ì•Šê¸° ë•Œë¬¸ì´ë‹¤.

`tsconfig.json` íŒŒì¼ì—ì„œ íƒ€ì… ì •ì˜ íŒŒì¼ì˜ ìœ„ì¹˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì •í•´ì£¼ë©´ í•´ê²°ëœë‹¤!  
=> `typeRoots`ì— ì ì–´ì¤€ë‹¤.

```json
"compilerOptions": {
// ...

"typeRoots": [
      "./typings",
      "./node_modules/@types"
    ]

// ...
}
```

ë‹¤ì‹œ `ts-node`ë¥¼ ì‹¤í–‰í•´ë³´ë©´ ì˜ ì‘ë™í•œë‹¤.

![](https://velog.velcdn.com/images/pmj9498/post/450e06dc-0394-4d03-915a-93bbb87ab50c/image.png)

## âœ¨ ORMì—ì„œ íƒ€ì… ì‚¬ìš©í•˜ê¸°

ìë°”ìŠ¤í¬ë¦½íŠ¸ ë°±ì—”ë“œì—ì„œ ì£¼ë¡œ í™œìš©í•˜ëŠ” ORMì—ì„œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ í™œìš©í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì•Œì•„ë´…ì‹œë‹¤. Mongooseì™€ Prismaì— ëŒ€í•´ ê°ê° ì‚´í´ë³´ê² ìŠµë‹ˆë‹¤!

### Mongoose

Mongooseë„ ìš°ì„  íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¡œ ì‚¬ìš©í•˜ë ¤ë©´ `@types/mongoose` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ ì£¼ì–´ì•¼ í•˜ê³  ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ë•Œ ì§ì ‘ ì¸í„°í˜ì´ìŠ¤ë¥¼ ì •ì˜í•˜ê³ , ì´ê±¸ ì œë„¤ë¦­ ë¬¸ë²•ìœ¼ë¡œ í™œìš©í•˜ê²Œ ëœë‹¤. ì§ì ‘ ì •ì˜í•œ ì¸í„°í˜ì´ìŠ¤ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìŠ¤í‚¤ë§ˆ íƒ€ì…ì´ë‘ ëª¨ë¸ íƒ€ì…ì„ ì •ì˜í•  ìˆ˜ ìˆë‹¤. ì•„ë˜ ì½”ë“œëŠ” [Mongoose ê³µì‹ë¬¸ì„œ ê°€ì´ë“œ](https://mongoosejs.com/docs/typescript.html)ì— ìˆëŠ” ì˜ˆì‹œ ì½”ë“œì…ë‹ˆë‹¤.

```ts
import { Schema, model, connect } from "mongoose";

// 1. Create an interface representing a document in MongoDB.
interface IUser {
  name: string;
  email: string;
  avatar?: string;
}

// 2. Create a Schema corresponding to the document interface.
const userSchema = new Schema<IUser>({
  name: { type: String, required: true },
  email: { type: String, required: true },
  avatar: String,
});

// 3. Create a Model.
const User = model<IUser>("User", userSchema);
```

ë˜ í•œ ê°€ì§€ íŠ¹ì´í•œ ì ì€ MongoDBì—ì„œëŠ” **ë°ì´í„°ë² ì´ìŠ¤ì—ì„œ ì•Œì•„ì„œ ë§Œë“¤ì–´ ì£¼ëŠ” ì•„ì´ë””**ê°€ ìˆëŠ”ë°, ì´ëŸ° ì•„ì´ë””ì— ëŒ€í•´ì„œëŠ” ë°˜ë“œì‹œ `Types.ObjectId` íƒ€ì…ì„ ì¨ì•¼ í•œë‹¤ê³  í•œë‹¤.

```ts
import { Schema, Types } from "mongoose";

// 1. Create an interface representing a document in MongoDB.
interface IUser {
  name: string;
  email: string;
  // Use `Types.ObjectId` in document interface...
  organization: Types.ObjectId;
}
```

### ğŸ™ Prisma

PrismaëŠ” ìì²´ì ìœ¼ë¡œ íƒ€ì…ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì§€ì›í•˜ê³  ìˆëŠ”ë°ìš”. ë” ë‚˜ì•„ê°€ì„œ í•„ìš”í•œ íƒ€ì… ì •ì˜ê¹Œì§€ë„ ì•Œì•„ì„œ ë§Œë“¤ì–´ ì¤ë‹ˆë‹¤.([ê´€ë ¨ ê³µì‹ ë¬¸ì„œ](https://www.prisma.io/docs/orm/prisma-schema/data-model/models#type-definitions))  
ì˜ˆë¥¼ ë“¤ì–´ `shcema.prisma` íŒŒì¼ì„ ì•„ë˜ì™€ ê°™ì´ ë§Œë“ ë‹¤ê³  í•©ì‹œë‹¤.

```ts
datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model File {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  name      String
  path      String
  size      Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
```

ì´ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì„ ê°€ì§€ê³  Prismaë¥¼ ì„¸íŒ…í•˜ê³  ë‚˜ë©´, ì•„ë˜ì™€ ê°™ì€ ì½”ë“œê°€ ì•Œì•„ì„œ íƒ€ì… ì¶”ë¡ ì´ ëœë‹¤. `File`ì´ë¼ëŠ” íƒ€ì…ì„ ì•Œì•„ì„œ ë§Œë“¤ì–´ ì£¼ê³ , ê·¸ ì•ˆì—ëŠ” `name`,`path`,`size` ë“±ë“±ì˜ í”„ë¡œí¼í‹°ì˜ íƒ€ì…ì´ ì •ì˜ë˜ëŠ” ê±´ë°,

```ts
const file = await prisma.file.create({
  data: {
    ...req.body,
    path: req.file?.path.replace(/^public\//, "http://localhost:3000/"),
    size: req.file?.size,
  },
});
```

ë§Œì•½ Prismaì—ì„œ ë§Œë“¤ì–´ ì¤€ íƒ€ì…ì„ í™œìš©í•˜ê³  ì‹¶ë‹¤ë©´ `@prisma/client`ì—ì„œ íƒ€ì…ì„ ê°€ì ¸ì™€ì„œ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```ts
import { File } from "@prisma/client";
import prisma from "../prisma";

export default async function createPost(
  title: string,
  content: string,
  file?: File
) {
  // ...
}
```
