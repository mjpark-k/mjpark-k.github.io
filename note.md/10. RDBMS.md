# âœ Prisma ê¸°ë³¸ê¸°

## ì˜ˆì‹œ comazon í”„ë¡œì íŠ¸ë¡œ ë‹¨ê³„ ì•Œì•„ë³´ê¸°

**1. package.json ì„¤ì •**

í•„ìš”í•œ íŒ¨í‚¤ì§€(`devDependencies`, `dependencies`)ì™€ ëª¨ë“ˆ íƒ€ì…(`type`) ê·¸ë¦¬ê³  ì»¤ë§¨ë“œ(`scripts`)ë¥¼ ì •ì˜í•œë‹¤.

```json
{
  "dependencies": {
    "@prisma/client": "^5.4.2",
    "dotenv": "^16.3.1",
    "express": "^4.18.2",
    "is-email": "^1.0.2",
    "is-uuid": "^1.0.2",
    "prisma": "^5.4.2",
    "superstruct": "^1.0.3"
  },
  "devDependencies": {
    "nodemon": "^3.0.1"
  },
  "type": "module",
  "scripts": {
    "dev": "nodemon app.js",
    "start": "node app.js"
  }
}
```

**2. íŒ¨í‚¤ì§€ ì„¤ì¹˜**

- `nodemon`: ì½”ë“œì— ë³€ê²½ ì‚¬í•­ì´ ìˆìœ¼ë©´ ìë™ìœ¼ë¡œ ì„œë²„ë¥¼ ì¬ì‹œì‘í•´ ì£¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬(ê°œë°œ í™˜ê²½ì—ì„œë§Œ í•„ìš”)
- `prisma`: Prisma ê´€ë ¨ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ëŠ” ë° í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `@prisma/client`: Prisma ê´€ë ¨ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `express`: ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ APIë¥¼ ë§Œë“¤ê¸° ìœ„í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬
- `superstruct`: ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- `is-email`: ê°’ì´ ì´ë©”ì¼ í˜•ì‹ì¸ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- `is-uuid`: ê°’ì´ UUID í˜•ì‹ì¸ì§€ í™•ì¸í•  ë•Œ ì‚¬ìš©í•˜ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬
- `dotenv`: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •ì— í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬

`package.json` íŒŒì¼ì— ëª…ì‹œëœ íŒ¨í‚¤ì§€ë“¤ì´ ëª¨ë‘ ì„¤ì¹˜(terminalì—ì„œ ì»¤ë§¨ë“œ ì‹¤í–‰)

```
npm install
```

3. **VScode Prisma ìµìŠ¤í…ì…˜ ì„¤ì¹˜** -> Prisma ì½”ë“œ syntax í•˜ì´ë¼ì´íŒ…, ë¬¸ë²•ê²€ì‚¬, í¬ë§¤íŒ… ê¸°ëŠ¥ì„ ì œê³µ

4. **PostgresSQL ì„¤ì¹˜**

5. **Prismaì™€ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”**

PostgreSQLì„ ì‚¬ìš©í•˜ë„ë¡ ì´ˆê¸°í™”

```
npx prisma init --datasource-provider postgresql
```

> Prisma ì»¤ë§¨ë“œëŠ” `npx prisma`ë¡œ ì‹œì‘ë¨

> **ìë™ Formatting(VScode Prisma ìµìŠ¤í…ì…˜ ê¸°ëŠ¥)**  
> window: `Shift + Alt + F `

## Prisma ì„¤ì¹˜ì™€ ì´ˆê¸°í™”

`Prisma`ë¥¼ ì‚¬ìš©í•˜ë ¤ë©´ `prisma` íŒ¨í‚¤ì§€ì™€ `@prisma/client` íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.

```
npm install prisma --save-dev
npm install @prisma/client
```

`prisma`ëŠ” **Prisma ê´€ë ¨ ì»¤ë§¨ë“œë¥¼ ì‹¤í–‰í•˜ëŠ”ë° í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì´ê³ , `@prisma/client`ëŠ” **Prisma ê´€ë ¨ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**ì…ë‹ˆë‹¤. `prisma`ëŠ” ë³´í†µ dev dependencyë¡œ ì„¤ì¹˜í•©ë‹ˆë‹¤.

VSCodeì˜ Prisma ìµìŠ¤í…ì…˜ë„ ì„¤ì¹˜í•´ ì£¼ëŠ” ê²ƒì´ ì¢‹ìŒ

`prisma` ì„¤ì¹˜ë¥¼ ì™„ë£Œí–ˆìœ¼ë©´ ì•„ë˜ ì»¤ë§¨ë“œë¡œ ì´ˆê¸°í™” ê°€ëŠ¥

```
npx prisma init --datasource-provider db-type
```

`db-type`ì€ `postgresql`, `mysql`, `sqlite` ë“±ìœ¼ë¡œ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `.env` íŒŒì¼ì— ìˆëŠ” ì •ë³´ë¥¼ í™˜ê²½ì— ë§ê²Œ ìˆ˜ì •í•˜ì„¸ìš”.

`postgrsql`ì„ ì‚¬ìš©í•˜ë ¤ë©´ macOSì—ì„œëŠ” ì»´í“¨í„° ìœ ì € ì´ë¦„ê³¼ ë¹„ë°€ë²ˆí˜¸, Windowsì—ì„œëŠ” postgresì™€ ì„¤ì¹˜ ì‹œ ì„¤ì •í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

## Prisma Schema

`schema.prisma`ë¼ëŠ” íŒŒì¼ì— í•„ìš”í•œ ëª¨ë¸ë“¤ì„ ì •ì˜í•©ë‹ˆë‹¤.

```prisma
// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  firstName String
  lastName  String
  address   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String   @id @default(uuid())
  name        String
  description String?
  category    Category
  price       Float
  stock       Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Category {
  FASHION
  BEAUTY
  SPORTS
  ELECTRONICS
  HOME_INTERIOR
  HOUSEHOLD_SUPPLIES
  KITCHENWARE
}
```

ê° í•„ë“œëŠ” í•„ë“œ ì´ë¦„, í•„ë“œ íƒ€ì…, ì–´íŠ¸ë¦¬ë·°íŠ¸(ì˜µì…”ë„)ë¡œ êµ¬ì„±ë¼ ìˆìŠµë‹ˆë‹¤. í•„ë“œ íƒ€ì…ì€ `?`ë¥¼ ì‚¬ìš©í•´ì„œ í•„ìˆ˜ ì—¬ë¶€ë¥¼ ì •í•  ìˆ˜ ìˆê³  ìì£¼ ì‚¬ìš©í•˜ëŠ” ì–´íŠ¸ë¦¬ë·°íŠ¸ëŠ” ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

- `@id`: í•„ë“œê°€ idë¼ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„
- `@unique`: ê³ ìœ  í•„ë“œ(ê°’ì´ ì¤‘ë³µë  ìˆ˜ ì—†ìŒ)ë¼ëŠ” ê²ƒì„ ë‚˜íƒ€ëƒ„
- `@default`: ë””í´íŠ¸ ê°’ì„ ì„¤ì •í•  ë•Œ ì‚¬ìš©
- `@updatedAt`: ê°ì²´ê°€ ìˆ˜ì •ë  ë•Œë§ˆë‹¤ ìˆ˜ì • ì‹œê°„ì„ í•„ë“œì— ê¸°ë¡í•¨

ìœ„ì²˜ëŸ¼ í•„ë“œì˜ ê°’ì´ ì •í•´ì§„ ê°’ ì¤‘ í•˜ë‚˜ë¼ë©´ enumì„ ì‚¬ìš©í•  ìˆ˜ë„ ìˆìŠµë‹ˆë‹¤.

## Prisma Migration

schema.prisma íŒŒì¼ì„ ë³€ê²½í•˜ë©´ ë§ˆì´ê·¸ë ˆì´ì…˜ì´ë¼ëŠ” ê²ƒì„ í•´ ì¤˜ì•¼ í•©ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì€ ìŠ¤í‚¤ë§ˆ íŒŒì¼ì˜ ë‚´ìš©ì„ ë°ì´í„°ë² ì´ìŠ¤ì— ë°˜ì˜í•´ ì£¼ëŠ” ê²ƒì…ë‹ˆë‹¤.  
ì˜ˆë¥¼ ë“¤ì–´ shcema.prismaì— ìƒˆë¡œìš´ ëª¨ë¸ì„ ì •ì˜í•˜ê³  ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•˜ë©´ PrismaëŠ” ìƒˆë¡œìš´ í…Œì´ë¸”ì„ ìƒì„±í•˜ëŠ” SQLë¬¸ì„ ë§Œë“¤ì–´ì„œ ì‹¤í–‰í•´ ì¤ë‹ˆë‹¤.

```
npx prisma migrate dev

âˆš Enter a name for the new migration: ... init
```

> ë§Œì•½ ìœˆë„ìš° 10ì—ì„œ `npx prisma migrate dev`ë¥¼ í–ˆì„ ë•Œ `Error: P1001: Can't reach database server at localhost:5432` ì—ëŸ¬ê°€ ë‚œë‹¤ë©´? => ğŸ’Š [í•´ê²° ë°©ë²•](https://www.codeit.kr/tutorials/157/%EC%9C%88%EB%8F%84%EC%9A%B0%2010%EC%97%90%EC%84%9C%20Prisma%20%EB%A7%88%EC%9D%B4%EA%B7%B8%EB%A0%88%EC%9D%B4%EC%85%98%EC%9D%B4%20%EC%95%88%20%EB%90%A0%20%EB%95%8C)

**<ì›¹ìœ¼ë¡œ ë°ì´í„° í™•ì¸í•˜ëŠ” ë²•>**

```
npx prisma studio
```

## Prisma Client

Prisma ClientëŠ” ëª¨ë¸ ì •ë³´ë¥¼ ì €ì¥í•˜ê³  ìˆê³  ì´ê±¸ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ì™€ ìƒí˜¸ì‘ìš©í•©ë‹ˆë‹¤. ë§ˆì´ê·¸ë ˆì´ì…˜ì„ í•  ë•Œë§ˆë‹¤ ìµœì‹  ëª¨ë¸ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ Prisma Clientë¥¼ ìƒì„±í•´ ì£¼ì£ . ëª¨ë“  ë°ì´í„°ë² ì´ìŠ¤ ì—°ì‚°ì€ Prisma Clientë¥¼ í†µí•´ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

```js
import { PrismaClient } from "@prisma/client";

const prisma = new PrismaClient();
```

ì—°ì‚°ì€ `prisma.model.method()` í˜•íƒœì´ë©° **Promise**ë¥¼ ë¦¬í„´í•©ë‹ˆë‹¤. ì´ ì—°ì‚°ì„ 'ì¿¼ë¦¬'ë¼ê³ ë„ ë¶€ë¦…ë‹ˆë‹¤.

```js
const id = "b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e";

const userData = {
  email: "yjkim@example.com",
  firstName: "ìœ ì§„",
  lastName: "ê¹€",
  address: "ì¶©ì²­ë¶ë„ ì²­ì£¼ì‹œ ë¶ë¬¸ë¡œ 210ë²ˆê¸¸ 5",
};

// ì—¬ëŸ¬ ìœ ì € ì¡°íšŒ
const users = await prisma.user.findMany();

// ìœ ì € 1ëª… ì¡°íšŒ
const user = await prisma.user.findUnique({
  where: {
    id,
  },
});

// ìœ ì € ìƒì„±
const user = await prisma.user.create({
  data: userData,
});

// ìœ ì € ìˆ˜ì •
const user = await prisma.user.update({
  where: {
    id,
  },
  data: {
    email: "yjkim2@example.com",
  },
});

// ìœ ì € ì‚­ì œ
const user = await prisma.user.delete({
  where: {
    id,
  },
});
```

`where`ëŠ” í•„í„°ë¥¼ í•  ë•Œ ì‚¬ìš©í•˜ê³ , `data`ëŠ” ë°ì´í„°ë¥¼ ì „ë‹¬í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.  
`.findMany()` ë©”ì†Œë“œì—ëŠ” ì•„ë˜ í”„ë¡œí¼í‹°ë„ ë§ì´ ì‚¬ìš©ë©ë‹ˆë‹¤.

- `orderBy`: ì •ë ¬ ê¸°ì¤€
- `skip`: ê±´ë„ˆë›¸ ë°ì´í„° ê°œìˆ˜
- `take`: ì¡°íšŒí•  ë°ì´í„° ê°œìˆ˜

ì˜ˆë¥¼ ë“¤ì–´ URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì™€ ì•„ë˜ë¥¼ ì•„ë˜ì™€ ê°™ì´ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```js
app.get("/users", async (req, res) => {
  const { offset = 0, limit = 10, order = "newest" } = req.query;
  let orderBy;
  switch (order) {
    case "oldest":
      orderBy = { createdAt: "asc" };
      break;
    case "newest":
    default:
      orderBy = { createdAt: "desc" };
  }
  const users = await prisma.user.findMany({
    orderBy,
    skip: parseInt(offset),
    take: parseInt(limit),
  });
  res.send(users);
});
```

ê·¸ ì™¸ì— ì¶”ê°€ì ì¸ CRUD ë©”ì†Œë“œ(Client ë©”ì†Œë“œ)ëŠ” [ë¬¸ì„œ](https://prisma.io/docs/orm/reference/prisma-client-reference#model-queries)ë¥¼ í†µí•´ í™•ì¸

ê·¸ ì™¸ì— í•„í„° ì¡°ê±´ì— ëŒ€í•œ ë‚´ìš©ì€ [ë¬¸ì„œ](https://www.prisma.io/docs/orm/reference/prisma-client-reference#filter-conditions-and-operators)ë¥¼ í†µí•´ í™•ì¸

## ë°ì´í„°ë² ì´ìŠ¤ ì‹œë”©

Prisma Clientë¥¼ ì´ìš©í•´ì„œ ë°ì´í„°ë² ì´ìŠ¤ ì‹œë”©ë„ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `.createMany()` ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ë°°ì—´ ë°ì´í„°ë¥¼ í•œêº¼ë²ˆì— ì‚½ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.(SQLiteì—ì„œëŠ” ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŒ)

```js
// seed.js
import { PrismaClient } from "@prisma/client";
import { USERS, PRODUCTS } from "./mock.js";

const prisma = new PrismaClient();

async function main() {
  // ê¸°ì¡´ ë°ì´í„° ì‚­ì œ
  await prisma.user.deleteMany();
  await prisma.product.deleteMany();

  // ëª© ë°ì´í„° ì‚½ì…
  await prisma.user.createMany({
    data: USERS,
    skipDuplicates: true,
  });

  await prisma.product.createMany({
    data: PRODUCTS,
    skipDuplicates: true,
  });
}

main()
  .then(async () => {
    await prisma.$disconnect();
  })
  .catch(async (e) => {
    console.error(e);
    await prisma.$disconnect();
    process.exit(1);
  });
```

```js
// mock.js
export const USERS = [
  // ...
];

export const PRODUCTS = [
  // ...
];
```

`package.json` íŒŒì¼ì— `seed` ì»¤ë§¨ë“œë¥¼ ì •ì˜í•˜ë©´ Prisma ì»¤ë§¨ë“œë¡œ ì‹œë”©í•  ìˆ˜ ìˆë‹¤.

```json
// package.json
{
  // ...
  "prisma": {
    "seed": "node prisma/seed.js"
  }
}
```

`"node prisma/seed.js"` ë¶€ë¶„ì€ ì‹œë“œ ì—°ì‚°ì„ ì‹¤í–‰í•˜ëŠ” íŒŒì¼ ê²½ë¡œ  
ì•„ë˜ ì»¤ë§¨ë“œë¡œ ì‹œë”©ì„ í•  ìˆ˜ ìˆë‹¤.

```
npx prisma db seed
```

## ì¿¼ë¦¬ íŒŒë¼ë¯¸í„° ì²˜ë¦¬

```js
app.get("/users", async (req, res) => {
  const { offset = 0, limit = 10, order = "newest" } = req.query;
  let orderBy;
  switch (order) {
    case "oldest":
      orderBy = { createdAt: "asc" };
      break;
    case "newest":
    default:
      orderBy = { createdAt: "desc" };
  }
  const users = await prisma.user.findMany({
    orderBy,
    skip: parseInt(offset),
    take: parseInt(limit),
  });
  res.send(users);
});
```

## ìœ íš¨ì„± ê²€ì‚¬

ë‹¤ì–‘í•œ ë°©ì‹ìœ¼ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•  ìˆ˜ ìˆì§€ë§Œ ì´ë²ˆ í† í”½ì—ì„œëŠ” `superstruct`ë¼ëŠ” ë¼ì´ë¸ŒëŸ¬ë¦¬ë¡œ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ ì§„í–‰í•œë‹¤. ì˜ˆìƒí•˜ëŠ” ë°ì´í„° í˜•ì‹ì„ ì •ì˜í•˜ê³  ì‹¤ì œ ë°ì´í„°ë¥¼ ë¹„êµí•˜ëŠ” ë°©ì‹ìœ¼ë¡œ ë¨¼ì € íŒ¨í‚¤ì§€ë“¤ì„ ì„¤ì¹˜í•´ì•¼ í•œë‹¤.

> ê·¸ ì „ì— ë¨¼ì € `superstruct`ê°€ ê¹”ë ¤ìˆëŠ”ì§€ í™•ì¸í•´ì•¼ í•œë‹¤. `npm list`ë¡œ ì„¤ì¹˜ëœ íŒ¨í‚¤ì§€ë¥¼ í™•ì¸

```
npm list
```

![](https://velog.velcdn.com/images/pmj9498/post/be137f79-f839-4052-af0e-cdb763ab60c0/image.png)

ì—†ë‹¤ë©´ ì•„ë˜ ì»¤ë§¨ë“œë¡œ ì„¤ì¹˜

```
npm install superstruct is-email is-uuid
```

`is-email`ì€ ì´ë©”ì¼ í˜•ì‹ì„ í™•ì¸í•˜ê³  ì‹¶ì€ ê²½ìš° ì„¤ì¹˜í•˜ë©´ ë˜ê³ , `is-uuid`ëŠ” UUID í˜•ì‹ì„ í™•ì¸í•˜ê³  ì‹¶ì€ ê²½ìš° ì„¤ì¹˜í•˜ë©´ ëœë‹¤.

`superstruct` ë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ `.string()`, `.number()`, `.integer()`, `.boolean()`, `.define()`, `.object()`, `.enums()`, `.array()`, `.partial()` íƒ€ì…ë“¤ë¡œ í‹€ì„ ì •ì˜í•˜ê³  `.size()`, `.min()`, `.max()` í•¨ìˆ˜ë¡œ ì œì•½ì„ ì¶”ê°€í•˜ë©´ ë©ë‹ˆë‹¤.

```js
// struct.js
import * as s from "superstruct";

const CATEGORIES = [
  "FASHION",
  "BEAUTY",
  "SPORTS",
  "ELECTRONICS",
  "HOME_INTERIOR",
  "HOUSEHOLD_SUPPLIES",
  "KITCHENWARE",
];

export const CreateUser = s.object({
  email: s.define("Email", isEmail),
  firstName: s.size(s.string(), 1, 30),
  lastName: s.size(s.string(), 1, 30),
  address: s.string(),
});

export const PatchUser = s.partial(CreateUser);

export const CreateProduct = s.object({
  name: s.size(s.string(), 1, 60),
  description: s.string(),
  category: s.enums(CATEGORIES),
  price: s.min(s.number(), 0),
  stock: s.min(s.integer(), 0),
});

export const PatchProduct = s.partial(CreateProduct);
```

ë°ì´í„°ë¥¼ ë¹„êµí•  ë•ŒëŠ” `assert()` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

```js
// app.js
import { assert } from "superstruct";
import { CreateUser } from "./structs.js";

// ...

app.post("/users", async (req, res) => {
  assert(req.body, CreateUser); // CreateUser í˜•ì‹ì´ ì•„ë‹ˆë¼ë©´ ì˜¤ë¥˜ ë°œìƒ
  // ...
});
```

## ì˜¤ë¥˜ ì²˜ë¦¬

```js
// app.js
import { PrismaClient, Prisma } from "@prisma/client";

// ...

function asyncHandler(handler) {
  return async function (req, res) {
    try {
      await handler(req, res);
    } catch (e) {
      if (
        e instanceof Prisma.PrismaClientValidationError ||
        e.name === "StructError"
      ) {
        res.status(400).send({ message: e.message });
      } else if (
        e instanceof Prisma.PrismaClientKnownRequestError &&
        e.code === "P2025"
      ) {
        res.sendStatus(404);
      } else {
        res.status(500).send({ message: e.message });
      }
    }
  };
}

// ...

app.post(
  "/users",
  asyncHandler(async (req, res) => {
    assert(req.body, CreateUser);
    // ...
  })
);
```

- `e.name === 'StructError'`: Superstruct ê°ì²´ì™€ í˜•ì‹ì´ ë‹¤ë¥¼ ê²½ìš° ë°œìƒ
- `e instanceof Prisma.PrismaClientValidationError`: ë°ì´í„°ë¥¼ ì €ì¥í•  ë•Œ ëª¨ë¸ì— ì •ì˜ëœ í˜•ì‹ê³¼ ë‹¤ë¥¸ ê²½ìš° ë°œìƒ(Superstructë¡œ ì² ì €íˆ ê²€ì‚¬í•˜ë©´ ì´ ìƒí™©ì€ ì˜ ë°œìƒí•˜ì§€ ì•Šì§€ë§Œ ì•ˆì „ì„±ì„ ìœ„í•´ ë‘˜ ë‹¤ ê²€ì‚¬)
- `e instanceof Prisma.PrismaClientKnownRequestError && e.code === 'P2025'`: ê°ì²´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ì„ ê²½ìš°

# âœ ê´€ê³„í˜• ë°ì´í„°ë² ì´ìŠ¤ ê¸°ë³¸ê¸°

## Primary Keyì™€ Foreign Key

![](https://velog.velcdn.com/images/pmj9498/post/a91cf34b-6015-4127-83d7-385eedeaf0fb/image.png)
![](https://velog.velcdn.com/images/pmj9498/post/ab73793f-896e-476c-a4a8-12ea28a4e67f/image.png)

## ë°ì´í„° ëª¨ë¸ë§

ì„œë¹„ìŠ¤ì— ì •í™•íˆ ì–´ë–¤ ë°ì´í„°ê°€ í•„ìš”í•˜ê³  ë°ì´í„° ê°„ ì–´ë–¤ ê´€ê³„ê°€ ìˆëŠ”ì§€ë¥¼ íŒŒì•…í•´ì„œ ì •êµí•˜ê²Œ í‘œí˜„í•˜ëŠ” ê²ƒ

### ER ëª¨ë¸(Entity-Relationship ëª¨ë¸)

ì´ëŠ” **ER ë‹¤ì´ì–´ê·¸ë¨**ì´ë¼ê³ ë„ ë¶€ë¦„

- **ê°œì²´(Entity)**
  - í˜„ì‹¤ ì„¸ê³„ì˜ ì‚¬ë¬¼ ë˜ëŠ” ê°ì²´
  - ì˜ˆ: ìœ ì €, ìƒí’ˆ, ì£¼ë¬¸
  - í•˜ë‚˜ì˜ ê°œì²´ = í•˜ë‚˜ì˜ í…Œì´ë¸”
- **ì†ì„±(Attribute)**
  - ê°œì²´ì˜ ì„¸ë¶€ ì •ë³´
  - ì˜ˆ: ìœ ì €ì˜ ì„±, ì´ë¦„, ì´ë©”ì¼
  - í•˜ë‚˜ì˜ ì†ì„± = í•˜ë‚˜ì˜ ì»¬ëŸ¼
- **ê´€ê³„(Relationship)**
  - ê°œì²´ ê°„ì˜ ê´€ê³„
  - ì˜ˆ: ìœ ì €ëŠ” ì£¼ë¬¸ì„ í•  ìˆ˜ ìˆë‹¤. / ì£¼ë¬¸ì€ ì—¬ëŸ¬ ìƒí’ˆì„ í¬í•¨í•œë‹¤.

## ER ëª¨ë¸ë§: ê°œì²´, ì†ì„±, ê´€ê³„ í›„ë³´ ì°¾ê¸°

**Business Rule(ì‚¬ì—… ê·œì¹™)**: ì‚¬ì—…ì´ë‚˜ ì„œë¹„ìŠ¤ê°€ ìš´ì˜ë˜ê¸° ìœ„í•´ ë”°ë¥´ëŠ” ê·œì¹™
![](https://velog.velcdn.com/images/pmj9498/post/bb748e76-259b-4b50-8140-fbed31ce7e16/image.png)

**ê°œì²´**: ì‚¬ìš©ì, ìƒí’ˆ, ì£¼ë¬¸

**ì†ì„±**:

- ì‚¬ìš©ì: ì´ë©”ì¼, ì„±, ì´ë¦„, ì£¼ì†Œ, ì´ë©”ì¼ ìˆ˜ì‹  ì—¬ë¶€
- ìƒí’ˆ: ì´ë¦„, ì„¤ëª…, ê°€ê²©, ì¹´í…Œê³ ë¦¬, ì¬ê³ 
- ì£¼ë¬¸: ì£¼ë¬¸ ìˆ˜ëŸ‰, ê°€ê²©, ì£¼ë¬¸ ì‹œ ìƒí’ˆì˜ ê°€ê²©, ìƒí’ˆì˜ ì› ê°€ê²©, ì¬ê³ , ìƒíƒœ
- ê·¸ ì™¸: ìƒì„± ì‹œê°„, ìˆ˜ì • ì‹œê°„

**ê´€ê³„**: ë‘ ê°œì²´ê°„ì˜ ê´€ê³„ë¥¼ ë¬˜ì‚¬í•˜ëŠ” ë™ì‚¬ì˜ ì§‘ì¤‘

- ì°œí•˜ë‹¤
- ì£¼ë¬¸í•˜ë‹¤
- í¬í•¨í•˜ë‹¤

![](https://velog.velcdn.com/images/pmj9498/post/8183ec58-9fa7-4a30-8ba5-6f187eecf270/image.png)

![](https://velog.velcdn.com/images/pmj9498/post/845516f4-9af7-49fb-9f6c-afcd8d9c6571/image.png)

## ER ëª¨ë¸ë§: ì¹´ë””ë„ë¦¬í‹°(Cardinality)

íŠ¹ì • ë°ì´í„° ì§‘í•©ì˜ ìœ ë‹ˆí¬í•œ ê°’ì˜ ê°œìˆ˜

> ê°œì²´ê°„ì˜ ê´€ê³„ê°€ ìˆì„ ë•Œ, A ê°œì²´ í•œ ê°œê°€ B ê°œì²´ ëª‡ ê°œì™€ ì—°ê²°ë  ìˆ˜ ìˆê³ , B ê°œì²´ í•œ ê°œê°€ A ê°œì²´ ëª‡ ê°œì™€ ì—°ê²°ë  ìˆ˜ ìˆëŠ”ì§€ë¥¼ ëœ»í•¨.

ER ëª¨ë¸(ìµœëŒ€ ì¹´ë””ë„ë¦¬í‹°ë§Œ í¬í•¨)
![](https://velog.velcdn.com/images/pmj9498/post/361a2090-f32c-4b48-96a9-d4648ba333b4/image.png)

(ìµœì†Œ ì¹´ë””ë„ë¦¬í‹°ë„ í¬í•¨)

![](https://velog.velcdn.com/images/pmj9498/post/b9800c3a-4324-478d-99ea-c6f4e3b81aad/image.png)

## ER ëª¨ë¸ => ë°ì´í„°ë² ì´ìŠ¤ í…Œì´ë¸”

**<1 ëŒ€ ë‹¤>** ê´€ê³„ëŠ” 'ë‹¤' ìª½ ê°œì²´ í…Œì´ë¸”ì— foreign keyë¥¼ ì¶”ê°€í•˜ë©´ ëœë‹¤.
![](https://velog.velcdn.com/images/pmj9498/post/cfac56b5-baea-4495-a86e-21a9ac676277/image.png)

**<1 ëŒ€ 1>** ê´€ê³„ëŠ” UserPreferenceì— foreign key ì»¬ëŸ¼ì„ ì¶”ê°€í•´ì£¼ê³  UNIQUEí•˜ê²Œ ë§Œë“¤ì–´ì¤€ë‹¤.
1 ëŒ€ 1ì´ë¼ Userì— ë°˜ëŒ€ë¡œ ì¶”ê°€í•´ì¤˜ë„ ë˜ì§€ë§Œ, í•˜ë‚˜ì˜ ê°œì²´ê°€ ë‹¤ë¥¸ ê°œì²´ì˜ ì†í•´ìˆë‚˜ ìƒê°í•´ë³´ë©´ ë³´í†µ ê°œì²´ì˜ ì†í•´ ìˆëŠ” ìª½ì— ì„¤ì •í•´ì£¼ëŠ” ê²ƒì´ ì¢‹ë‹¤.

![](https://velog.velcdn.com/images/pmj9498/post/8191663e-30d0-4eff-95c1-1cba4aea1dbb/image.png)

**<ë‹¤ ëŒ€ ë‹¤>** ê´€ê³„ëŠ” í…Œì´ë¸”ì— ì§ì ‘ foreign keyë¥¼ ì •ì˜í•˜ì§€ ì•Šê³  í•˜ë‚˜ì˜ ìƒˆë¡œìš´ junction tableì„ ë§Œë“¤ì–´ì•¼ í•œë‹¤. foreign key ì»¬ëŸ¼ í•˜ë‚˜ë§Œìœ¼ë¡œëŠ” ë‹¤ ëŒ€ ë‹¤ ê´€ê³„ë¥¼ ì €ì¥í•  ìˆ˜ ì—†ê¸° ë•Œë¬¸ì´ë‹¤.

![](https://velog.velcdn.com/images/pmj9498/post/c6877d4c-4b64-4c79-9630-9d89baf23af2/image.png)

ì´ê²ƒë“¤ì„ ëª¨ë‘ ER ëª¨ë¸ì— ë°˜ì˜í•˜ë©´(íŒŒë€ìƒ‰ì€ foreign key)
![](https://velog.velcdn.com/images/pmj9498/post/a1ab385b-4073-45db-8281-533a7367948e/image.png)

# ğŸ›  ê´€ê³„ ì •ì˜(Prismaì™€ ê´€ê³„ ì •ë¦¬)

## ì¼ëŒ€ë‹¤ ê´€ê³„

```prisma
model User {
  // ...
  orders  Order[]
}

model Order {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String
}
```

'ë‹¤'ì— í•´ë‹¹í•˜ëŠ” ëª¨ë¸ì—ëŠ” ì•„ë˜ í•„ë“œë¥¼ ì •ì˜

- ë‹¤ë¥¸ëª¨ë¸ì„ ê°€ë¦¬í‚¤ëŠ” ê´€ê³„ í•„ë“œ(`user`): `@relation` ì–´íŠ¸ë¦¬ë·°íŠ¸ë¡œ foreign key í•„ë“œê°€ ë¬´ì—‡ì´ê³ , ì–´ë–¤ í•„ë“œë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ëª…ì‹œ
- Foreign key í•„ë“œ(userId)

'ì¼'ì— í•´ë‹¹í•˜ëŠ” ëª¨ë¸ì—ëŠ” ì•„ë˜ í•„ë“œë¥¼ ì •ì˜

- ë‹¤ë¥¸ ëª¨ë¸ ë°°ì—´ì„ ì €ì¥í•˜ëŠ” ê´€ê³„ í•„ë“œ(`orders`)

## ì¼ëŒ€ì¼ ê´€ê³„

```prisma
model User {
  // ...
  userPreference  UserPreference?
}

model UserPreference {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String  @unique
}
```

Foreign keyë¥¼ ì–´ëŠ ìª½ì— ì •ì˜í•˜ë“  í° ìƒê´€ì€ ì—†ì§€ë§Œ, ë§Œì•½ í•œ ìª½ ëª¨ë¸ì´ ë‹¤ë¥¸ ìª½ ëª¨ë¸ì— **ì†í•´ ìˆë‹¤**ë©´ ì†í•´ ìˆëŠ” ëª¨ë¸ì— ì •ì˜í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

Foreign keyë¥¼ ì •ì˜í•˜ëŠ” ëª¨ë¸ì—ëŠ” ì•„ë˜ í•„ë“œë¥¼ ì •ì˜

- ë‹¤ë¥¸ ëª¨ë¸ì„ ê°€ë¦¬í‚¤ëŠ” ê´€ê³„ í•„ë“œ(`user`): `@relation` ì–´íŠ¸ë¦¬ë·°íŠ¸ë¡œ foreign key í•„ë“œê°€ ë¬´ì—‡ì´ê³ , ì–´ë–¤ í•„ë“œë¥¼ ì°¸ì¡°í•˜ëŠ”ì§€ ëª…ì‹œ
- Foreign key í•„ë“œ(`userId`): `@unique`ë¡œ ì„¤ì •í•´ì¤˜ì•¼ í•¨

ë°˜ëŒ€ ìª½ ëª¨ë¸ì—ëŠ” ì•„ë˜ í•„ë“œë¥¼ ì •ì˜

- ë‹¤ë¥¸ ëª¨ë¸ì„ ê°€ë¦¬í‚¤ëŠ” ì˜µì…”ë„ ê´€ê³„ í•„ë“œ(`userPreference`)

## ë‹¤ëŒ€ë‹¤ ê´€ê³„

```prisma
model User {
  // ...
  savedProducts  Product[]
}

model Product {
  // ...
  savedUsers  User[]
}
```

ì–‘ ìª½ ëª¨ë¸ì— ì„œë¡œì˜ ë°°ì—´ì„ ì €ì¥í•˜ëŠ” ê´€ê³„ í•„ë“œë¥¼ ì •ì˜í•˜ë©´ ëœë‹¤.

## ìµœì†Œ ì¹´ë””ë„ë¦¬í‹°

ìµœì†Œ ì¹´ë””ë„ë¦¬í‹°ëŠ” ìŠ¤í‚¤ë§ˆë¡œ ì™„ë²½íˆ ì œì–´í•˜ê¸° ì–´ë µë‹¤. ìœ ì¼í•˜ê²Œ ì„¤ì •í•  ìˆ˜ ìˆëŠ” ë¶€ë¶„ì€ Foreign keyì™€ ê´€ê³„ ì˜µì…”ë„(`?`)í•˜ê²Œ ë§Œë“œëŠ” ê²ƒì…ë‹ˆë‹¤.  
Foreign keyê°€ ìˆëŠ” ëª¨ë¸ ë°˜ëŒ€ìª½ì˜ ìµœì†Œ ì¹´ë””ë„ë¦¬í‹°ê°€ 1ì´ë¼ë©´ foreign keyì™€ ê´€ê³„ í•„ë“œë¥¼ í•„ìˆ˜ë¡œ ë§Œë“¤ê³  ìµœì†Œ ì¹´ë””ë„ë¦¬í‹°ê°€ 0ì´ë¼ë©´ foreign keyì™€ ê´€ê³„ í•„ë“œë¥¼ ì˜µì…”ë„í•˜ê²Œ ë§Œë“¤ë©´ ëœë‹¤.

![](https://velog.velcdn.com/images/pmj9498/post/66b683db-0d10-4f05-90cb-248345afb7e1/image.png)

```prisma
model User {
  // ...
  orders  Order[]
}

model Order {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String
}
```

```prisma
model User {
  // ...
  orders  Order[]
}

model Order {
  // ...
  user    User?    @relation(fields: [userId], references: [id])
  userId  String?
}
```

## `onDelete` ì˜µì…˜

`onDelete` ì˜µì…˜ì€ ì—°ê²°ëœ ë°ì´í„°ê°€ ì‚­ì œëì„ ë•Œ, ê¸°ì¡´ ë°ì´í„°ë¥¼ ì–´ë–»ê²Œ ì²˜ë¦¬í• ì§€ë¥¼ ì •í•˜ëŠ” ì˜µì…˜

```prisma
model Order {
  // ...
  user    User    @relation(fields: [userId], references: [id], onDelete: ...)
  userId  String
}
```

- `Cascade`: `userId`ê°€ ê°€ë¦¬í‚¤ëŠ” ìœ ì €ê°€ ì‚­ì œë˜ë©´ ê¸°ì¡´ ë°ì´í„°ë„ ì‚­ì œëœë‹¤.
- `Restrict`: `userId`ë¥¼ í†µí•´ ìœ ì €ë¥¼ ì°¸ì¡°í•˜ëŠ” ì£¼ë¬¸ì´ í•˜ë‚˜ë¼ë„ ìˆë‹¤ë©´ ìœ ì €ë¥¼ ì‚­ì œí•  ìˆ˜ ì—†ë‹¤.
- `SetNull`: `userId`ê°€ ê°€ë¦¬í‚¤ëŠ” ìœ ì €ê°€ ì‚­ì œë˜ë©´ `userId`ë¥¼ NULLë¡œ ì„¤ì •í•œë‹¤. ì´ ë•Œ, **`user`ì™€ `userId` ëª¨ë‘ ì˜µì…”ë„ í•´ì•¼ í•¨**
- `SetDefault`: `userId`ê°€ ê°€ë¦¬í‚¤ëŠ” ìœ ì €ê°€ ì‚­ì œë˜ë©´ `userId`ë¥¼ ë””í´íŠ¸ ê°’ìœ¼ë¡œ ì„¤ì •í•œë‹¤. **`userId` í•„ë“œì— @default()ë¥¼ ì œê³µí•´ì•¼ í•¨**

ê´€ê³„ í•„ë“œì™€ foreign keyê°€ í•„ìˆ˜ ì¼ ê²½ìš° `Restrict`ê°€ ê¸°ë³¸ê°’ì´ê³ , ì˜µì…”ë„í•  ê²½ìš° `SetNull`ì´ ê¸°ë³¸ ê°’ì´ë‹¤.

# ğŸ›  ê´€ê³„ í™œìš©(Prismaì™€ ê´€ê³„ ì •ë¦¬)

Prisma Clientì—ì„œëŠ” ê´€ê³„ í•„ë“œë“¤ì„ ììœ ë¡­ê²Œ ì´ìš© ê°€ëŠ¥

```prisma
model User {
  // ...
  orders  Order[]
}

model Order {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String
}
```

ì˜ˆë¥¼ ë“¤ì–´ ìœ„ì™€ ê°™ì€ ê´€ê³„ê°€ ìˆì„ ë•Œ, `orders` í•„ë“œì™€ `user` í•„ë“œëŠ” ì‹¤ì œë¡œ ì–´ë–¤ ë°ì´í„°ë¥¼ ì €ì¥í•˜ì§€ ì•Šì§€ë§Œ(ë°ì´í„°ë² ì´ìŠ¤ì—ì„œëŠ” `userId`ë¡œ ìœ ì €ì˜ `id`ë§Œ ì €ì¥í•˜ë©´ ë¨) Prismaì½”ë“œë¥¼ ì‘ì„±í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

## ê´€ë ¨ëœ ê°ì²´ ì¡°íšŒ

```prisma
model User {
  // ...
  userPreference  UserPreference?
}

model UserPreference {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String  @unique
}
```

`userPreference`ë‚˜ `user` ê°™ì€ í•„ë“œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ì¡°íšŒ ê²°ê³¼ì— í¬í•¨ë˜ì§€ ì•ŠëŠ”ë‹¤. **ì´ëŸ° í•„ë“œë¥¼ ê°™ì´ ì¡°íšŒí•˜ë ¤ë©´ `include` í”„ë¡œí¼í‹°ë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤.**

```js
// app.js
const id = "6c3a18b0-11c5-4d97-9019-9ebe3c4d1317";

const user = await prisma.user.findUniqueOrThrow({
  where: { id },
  include: {
    userPreference: true,
  },
});

console.log(user);
```

```
{
  id: '6c3a18b0-11c5-4d97-9019-9ebe3c4d1317',
  email: 'kimyh@example.com',
  firstName: 'ì˜í¬',
  lastName: 'ê¹€',
  address: 'ê²½ê¸°ë„ ê³ ì–‘ì‹œ ë´‰ëª…ë¡œ 789ë²ˆê¸¸ 21',
  createdAt: 2023-07-16T09:30:00.000Z,
  updatedAt: 2023-07-16T09:30:00.000Z,
  userPreference: {
    id: 'e1c1e5c1-5312-4f7b-a3d6-4cbb2b4f8828',
    receiveEmail: false,
    createdAt: 2023-07-16T09:30:00.000Z,
    updatedAt: 2023-07-16T09:30:00.000Z,
    userId: '6c3a18b0-11c5-4d97-9019-9ebe3c4d1317'
  }
}
```

ë„¤ìŠ¤íŒ…ì„ ì´ìš©í•´ì„œ ê´€ë ¨ëœ ê°ì²´ì˜ íŠ¹ì • í•„ë“œë§Œ ì¡°íšŒí•  ìˆ˜ë„ ìˆë‹¤.

```js
// app.js
const id = "6c3a18b0-11c5-4d97-9019-9ebe3c4d1317";

const user = await prisma.user.findUniqueOrThrow({
  where: { id },
  include: {
    userPreference: {
      select: {
        receiveEmail: true,
      },
    },
  },
});

console.log(user);
```

```
{
  id: '6c3a18b0-11c5-4d97-9019-9ebe3c4d1317',
  email: 'kimyh@example.com',
  firstName: 'ì˜í¬',
  lastName: 'ê¹€',
  address: 'ê²½ê¸°ë„ ê³ ì–‘ì‹œ ë´‰ëª…ë¡œ 789ë²ˆê¸¸ 21',
  createdAt: 2023-07-16T09:30:00.000Z,
  updatedAt: 2023-07-16T09:30:00.000Z,
  userPreference: { receiveEmail: false }
}
```

ê´€ê³„ í•„ë“œê°€ ë°°ì—´ í˜•íƒœì—¬ë„ ë˜‘ê°™ì´ `include`ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

```prisma
// schema.prisma
model User {
  // ...
  savedProducts  Product[]
}

model Product {
  // ...
  savedUsers  User[]
}
```

```js
// app.js
const id = "6c3a18b0-11c5-4d97-9019-9ebe3c4d1317";

const user = await prisma.user.findUniqueOrThrow({
  where: { id },
  include: {
    savedProducts: true,
  },
});

res.send(user);
```

```
{
  id: '6c3a18b0-11c5-4d97-9019-9ebe3c4d1317',
  email: 'kimyh@example.com',
  firstName: 'ì˜í¬',
  lastName: 'ê¹€',
  address: 'ê²½ê¸°ë„ ê³ ì–‘ì‹œ ë´‰ëª…ë¡œ 789ë²ˆê¸¸ 21',
  createdAt: 2023-07-16T09:30:00.000Z,
  updatedAt: 2023-07-16T09:30:00.000Z,
  savedProducts: [
    {
      id: 'f8013040-b076-4dc4-8677-11be9a17162f',
      name: 'ë‘ë°© ìƒ¤ì›Œì ¤ ì„¸íŠ¸',
      description: 'ë‘ë°©ì˜ í–¥ê¸°ë¡œìš´ ìƒ¤ì›Œì ¤ ì„¸íŠ¸ì…ë‹ˆë‹¤. í”¼ë¶€ë¥¼ ë¶€ë“œëŸ½ê²Œ ì¼€ì–´í•˜ë©°, í–¥ê¸°ë¡œìš´ ìƒ¤ì›Œ ì‹œê°„ì„ ì„ ì‚¬í•©ë‹ˆë‹¤.',
      category: 'BEAUTY',
      price: 38000,
      stock: 20,
      createdAt: 2023-07-14T10:00:00.000Z,
      updatedAt: 2023-07-14T10:00:00.000Z
    },
    {
      id: '7f70481b-784d-4b0e-bc3e-f05eefc17951',
      name: 'Apple AirPods í”„ë¡œ',
      description: 'Appleì˜ AirPods í”„ë¡œëŠ” íƒì›”í•œ ì‚¬ìš´ë“œ í’ˆì§ˆê³¼ ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§ ê¸°ëŠ¥ì„ ê°–ì¶˜ ë¬´ì„  ì´ì–´í°ì…ë‹ˆë‹¤. ê°„í¸í•œ í„°ì¹˜ ì»¨íŠ¸ë¡¤ê³¼ ê¸´ ë°°í„°ë¦¬ ìˆ˜ëª…ì„ ì œê³µí•©ë‹ˆë‹¤.',
      category: 'ELECTRONICS',
      price: 320000,
      stock: 10,
      createdAt: 2023-07-14T11:00:00.000Z,
      updatedAt: 2023-07-14T11:00:00.000Z
    },
    {
      id: '4e0d9424-3a16-4a5e-9725-0e9d2f9722b3',
      name: 'ë² ë¥´ì‚¬ì²´ í™”ì¥í’ˆ ì„¸íŠ¸',
      description: 'ë² ë¥´ì‚¬ì²´ì˜ í™”ì¥í’ˆ ì„¸íŠ¸ë¡œ í™”ë ¤í•˜ê³  íŠ¹ë³„í•œ ë¶„ìœ„ê¸°ë¥¼ ì—°ì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë‹¤ì–‘í•œ ì•„ì´í…œìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ê³ í’ˆì§ˆ ì„±ë¶„ì„ ì‚¬ìš©í•˜ì—¬ í”¼ë¶€ì— ë¶€ë“œëŸ½ê³  ì•ˆì •ì ì¸ ê´€ë¦¬ë¥¼ ì œê³µí•©ë‹ˆë‹¤.',
      category: 'BEAUTY',
      price: 65000,
      stock: 8,
      createdAt: 2023-07-14T11:30:00.000Z,
      updatedAt: 2023-07-14T11:30:00.000Z
    },
    {
      id: 'a4ff201c-48f7-4963-b317-2e9e4e3e43b7',
      name: 'ë‘ë°© ë§¤íŠ¸ í‹´íŠ¸',
      description: 'ë‘ë°© ë§¤íŠ¸ í‹´íŠ¸ëŠ” í’ë¶€í•œ ì»¬ëŸ¬ì™€ ì§€ì†ë ¥ì„ ì œê³µí•˜ëŠ” ì œí’ˆì…ë‹ˆë‹¤. ì…ìˆ ì— ë¶€ë“œëŸ½ê²Œ ë°œë¦¬ë©° ì˜¤ë˜ ì§€ì†ë˜ëŠ” ë§¤íŠ¸í•œ ë§ˆë¬´ë¦¬ë¥¼ ì„ ì‚¬í•©ë‹ˆë‹¤.',
      category: 'BEAUTY',
      price: 35000,
      stock: 20,
      createdAt: 2023-07-14T16:00:00.000Z,
      updatedAt: 2023-07-14T16:00:00.000Z
    }
  ]
}
```

## ê´€ë ¨ëœ ê°ì²´ ìƒì„±, ìˆ˜ì •

ê°ì²´ë¥¼ ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ë•Œ ê´€ë ¨ëœ ê°ì²´ë¥¼ ë™ì‹œì— ìƒì„±í•˜ê±°ë‚˜ ìˆ˜ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```prisma
model User {
  // ...
  userPreference  UserPreference?
}

model UserPreference {
  // ...
  user    User    @relation(fields: [userId], references: [id])
  userId  String  @unique
}
```

ë°ì´í„°ë¥¼ `data` í”„ë¡œí¼í‹°ë¡œ ë°”ë¡œ ì „ë‹¬í•˜ì§€ ì•Šê³  ê´€ë ¨ëœ ê°ì²´ í•„ë“œì— `create` ë˜ëŠ” `update` í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•´ì•¼ í•œë‹¤.

```js
// app.js
/* create */

const postBody = {
  email: "yjkim@example.com",
  firstName: "ìœ ì§„",
  lastName: "ê¹€",
  address: "ì¶©ì²­ë¶ë„ ì²­ì£¼ì‹œ ë¶ë¬¸ë¡œ 210ë²ˆê¸¸ 5",
  userPreference: {
    receiveEmail: false,
  },
};

const { userPreference, ...userFields } = postBody;

const user = await prisma.user.create({
  data: {
    ...userFields,
    userPreference: {
      create: userPreference,
    },
  },
  include: {
    userPreference: true,
  },
});

console.log(user);
```

```
{
  id: 'd2f4a7fe-0831-462f-9b11-baddb0e4aba2',
  email: 'yjkim@example.com',
  firstName: 'ìœ ì§„',
  lastName: 'ê¹€',
  address: 'ì¶©ì²­ë¶ë„ ì²­ì£¼ì‹œ ë¶ë¬¸ë¡œ 210ë²ˆê¸¸ 5',
  createdAt: 2023-08-25T05:12:00.740Z,
  updatedAt: 2023-08-25T05:12:00.740Z,
  userPreference: {
    id: '8dffa6b8-bb2e-4c6e-82ef-053d69b4face',
    receiveEmail: false,
    createdAt: 2023-08-25T05:12:00.740Z,
    updatedAt: 2023-08-25T05:12:00.740Z,
    userId: 'd2f4a7fe-0831-462f-9b11-baddb0e4aba2'
  }
}
```

```js
// app.js
/* update */

const id = "b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e";

const patchBody = {
  email: "honggd2@example.com",
  userPreference: {
    receiveEmail: false,
  },
};

const { userPreference, ...userFields } = patchBody;

const user = await prisma.user.update({
  where: { id },
  data: {
    ...userFields,
    userPreference: {
      update: userPreference,
    },
  },
  include: {
    userPreference: true,
  },
});

console.log(user);
```

```
{
  id: 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e',
  email: 'honggd2@example.com',
  firstName: 'ê¸¸ë™',
  lastName: 'í™',
  address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ë¬´ì‹¤ë¡œ 123ë²ˆê¸¸ 45-6',
  createdAt: 2023-07-16T09:00:00.000Z,
  updatedAt: 2023-08-25T05:15:06.106Z,
  userPreference: {
    id: '936f5ea4-6e6c-4e5e-91a3-78f5644e1f9a',
    receiveEmail: false,
    createdAt: 2023-07-16T09:00:00.000Z,
    updatedAt: 2023-08-25T05:15:06.106Z,
    userId: 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e'
  }
}
```

## ê´€ë ¨ëœ ê°ì²´ ì—°ê²° ë° ì—°ê²° í•´ì œí•˜ê¸°

ë‹¤ëŒ€ë‹¤ ê´€ê³„ëŠ” ë³´í†µ ë‘ ê°ì²´ê°€ ì´ë¯¸ ì¡´ì¬í•˜ê³ , ê·¸ ì‚¬ì´ì— ê´€ê³„ë¥¼ ìƒì„±í•˜ë ¤ê³  í•˜ëŠ” ê²½ìš°ê°€ ë§ë‹¤. **ì´ëŸ° ê²½ìš° `connect` í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.**

```prisma
model User {
  // ...
  savedProducts  Product[]
}

model Product {
  // ...
  savedUsers  User[]
}
```

```js
// app.js
const userId = "b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e";
const productId = "c28a2eaf-4d87-4f9f-ae5b-cbcf73e24253";

const user = await prisma.user.update({
  where: { id: userId },
  data: {
    savedProducts: {
      connect: {
        id: productId,
      },
    },
  },
  include: {
    savedProducts: true,
  },
});

console.log(user);
```

```
{
  id: 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e',
  email: 'honggd2@example.com',
  firstName: 'ê¸¸ë™',
  lastName: 'í™',
  address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ë¬´ì‹¤ë¡œ 123ë²ˆê¸¸ 45-6',
  createdAt: 2023-07-16T09:00:00.000Z,
  updatedAt: 2023-08-25T05:15:06.106Z,
  savedProducts: [
    {
      id: 'c28a2eaf-4d87-4f9f-ae5b-cbcf73e24253',
      name: 'ì¿ ì§„ì•¤ì—ì´ ì˜¤ë¯ˆë › íŒ¬',
      description: 'ì¿ ì§„ì•¤ì—ì´ì˜ ì˜¤ë¯ˆë › íŒ¬ì€ ì˜¤ë¯ˆë ›ì„ ì‰½ê³  ë¹ ë¥´ê²Œ ë§Œë“¤ ìˆ˜ ìˆëŠ” ì „ìš© íŒ¬ì…ë‹ˆë‹¤. ë‚´ì—´ì„±ì´ ë›°ì–´ë‚˜ë©° ë…¼ìŠ¤í‹± ì²˜ë¦¬ë¡œ í¸ë¦¬í•œ ì‚¬ìš©ê³¼ ì²­ì†Œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.',
      category: 'KITCHENWARE',
      price: 25000,
      stock: 8,
      createdAt: 2023-07-15T13:30:00.000Z,
      updatedAt: 2023-07-15T13:30:00.000Z
    }
  ]
}
```

ë°˜ëŒ€ë¡œ ì—°ê²°ì„ í•´ì œí•˜ê³  ì‹¶ë‹¤ë©´ disconnect í”„ë¡œí¼í‹°ë¥¼ ì´ìš©í•˜ë©´ ëœë‹¤.

```js
const userId = 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e';
const productId =

const user = await prisma.user.update({
  where: { id: userId },
  data: {
    savedProducts: {
      disconnect: {
        id: productId,
      },
    },
  },
  include: {
    savedProducts: true,
  },
});

console.log(user);
```

```
{
  id: 'b8f11e76-0a9e-4b3f-bccf-8d9b4fbf331e',
  email: 'honggd2@example.com',
  firstName: 'ê¸¸ë™',
  lastName: 'í™',
  address: 'ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ë¬´ì‹¤ë¡œ 123ë²ˆê¸¸ 45-6',
  createdAt: 2023-07-16T09:00:00.000Z,
  updatedAt: 2023-08-25T05:15:06.106Z,
  savedProducts: []
}
```
